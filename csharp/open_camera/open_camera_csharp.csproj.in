<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>net6.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>warnings</Nullable>
    <Platforms Condition="'$(OS)'=='Windows_NT'">x86;x64</Platforms>
    <Platforms Condition="'$(OS)'=='Unix'">x86;x64;arm;arm64</Platforms>
    <RuntimeIdentifiers>win-x86;win-x64;linux-x64;linux-arm;linux-arm64</RuntimeIdentifiers>
  </PropertyGroup>

  <Target Name="ValidateCommandLine" BeforeTargets="ResolveAssemblyReferences">
      <Error Text=" The 'Platform' property must be set on the command line."
             Condition="'$(Platform)' == ''" />
      <Error Text=" The 'Platform' property must not be set to Any/AnyCPU."
             Condition="$(Platform.Contains('Any'))" />
  </Target>

  <ItemGroup>
    <Reference Include="${Branding_Product_NameBinary_Visionapi}_dotnet" >
      <HintPath Condition="'$(Platform)'=='x86' And '$(OS)'=='Windows_NT'">${VAPI_ROOT_PATH}\binding\dotnet\x86_32\${Branding_Product_NameBinary_Visionapi}_dotnet.dll</HintPath>
      <HintPath Condition="'$(Platform)'=='x64' And '$(OS)'=='Windows_NT'">${VAPI_ROOT_PATH}\binding\dotnet\x86_64\${Branding_Product_NameBinary_Visionapi}_dotnet.dll</HintPath>
      <HintPath Condition="'$(Platform)'=='x64' And '$(OS)'=='Unix'">${VAPI_ROOT_PATH_LINUX}/x86_64/${Branding_Product_NameBinary_Visionapi}_dotnet.dll</HintPath>
      <HintPath Condition="'$(Platform)'=='arm' And '$(OS)'=='Unix'">${VAPI_ROOT_PATH_LINUX}/armhf/${Branding_Product_NameBinary_Visionapi}_dotnet.dll</HintPath>
      <HintPath Condition="'$(Platform)'=='arm64' And '$(OS)'=='Unix'">${VAPI_ROOT_PATH_LINUX}/arm64/${Branding_Product_NameBinary_Visionapi}_dotnet.dll</HintPath>
    </Reference>
  </ItemGroup>

  <Target Name="CopyDependencies" BeforeTargets="Build">
    <ItemGroup Condition="'$(Platform)'=='x86' And '$(OS)'=='Windows_NT'">
        <Dependencies Include="${VAPI_ROOT_PATH}\binding\dotnet\x86_32\${Branding_Product_NameBinary_Visionapi}_dotnet_interface.dll" />
        <Dependencies Include="${VAPI_ROOT_PATH}\lib\x86_32\*.dll" />
    </ItemGroup>
    <ItemGroup Condition="'$(Platform)'=='x64' And '$(OS)'=='Windows_NT'">
        <Dependencies Include="${VAPI_ROOT_PATH}\binding\dotnet\x86_64\${Branding_Product_NameBinary_Visionapi}_dotnet_interface.dll" />
        <Dependencies Include="${VAPI_ROOT_PATH}\lib\x86_64\*.dll" />
    </ItemGroup>
    <ItemGroup Condition="'$(Platform)'=='x64' And '$(OS)'=='Unix'">
        <Dependencies Include="${VAPI_ROOT_PATH_LINUX}/x86_64/lib${Branding_Product_NameBinary_Visionapi}_dotnet_interface.so" />
        <Dependencies Include="/usr/lib/${Branding_Product_NameBinary_Visionapi}-*/*.so" />
    </ItemGroup>
    <ItemGroup Condition="'$(Platform)'=='arm' And '$(OS)'=='Unix'">
        <Dependencies Include="${VAPI_ROOT_PATH_LINUX}/armhf/lib${Branding_Product_NameBinary_Visionapi}_dotnet_interface.so" />
        <Dependencies Include="/usr/lib/${Branding_Product_NameBinary_Visionapi}-*/*.so" />
    </ItemGroup>
    <ItemGroup Condition="'$(Platform)'=='arm64' And '$(OS)'=='Unix'">
        <Dependencies Include="${VAPI_ROOT_PATH_LINUX}/arm64/lib${Branding_Product_NameBinary_Visionapi}_dotnet_interface.so" />
        <Dependencies Include="/usr/lib/${Branding_Product_NameBinary_Visionapi}-*/*.so" />
    </ItemGroup>
    <Copy
        SourceFiles="@(Dependencies)"
        DestinationFolder="$(TargetDir)"
        SkipUnchangedFiles="true" />
  </Target>

</Project>
